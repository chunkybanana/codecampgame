<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        canvas {
            border: 1px solid #d3d3d3;
            background-color: #f1f1f1;
            image-rendering: -moz-crisp-edges;
            image-rendering: -webkit-crisp-edges;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }
        img {
            transform: translate(-482px,-226px);
            width: 260px;
            image-rendering: -moz-crisp-edges;
            image-rendering: -webkit-crisp-edges;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }
        #game{
            height: 702px;
            width: 1100px;
        }
    </style>
</head>
<body onload="startGame()">
    <script>
        var walkable = ['floor', 'tb', 'ep'];
        var tasks = ['tb', 'ep'];
        var blocks = [];
        var buttonset = Math.floor(Math.random() * 3)
        var xpos = 17, ypos = 3, height = 32, width = 32;
function loadTiles(){
	for(var row = 0; row < height; row++){
		for(var tile = 0; tile < width; tile++){
				blocks.push('out');			
		}
    }
    addRoom(3, 3, 4, 5, 1, 1, 1, 1);
    addRoom(14, 3, 4, 8, 1, 1, 1, 1);
    addRoom(25, 3, 5, 4, 1, 1, 1, 1);
    addRoom(3, 10, 5, 8, 1, 1, 1, 1);
    addRoom(12, 10, 5, 6, 1, 1, 1, 1);
    addRoom(11, 16, 3, 7, 1, 1, 1, 1);
    addRoom(13, 22, 5, 5, 1, 1, 1, 1);
    addRoom(23, 11, 3, 6, 1, 1, 1, 1);

    addRoom(3, 7, 3, 1, 0, 1, 0, 1);
    addRoom(19, 7, 21, 1, 0, 1, 1, 1);
    addRoom(9, 15, 13, 1, 0, 1, 1, 1);

    addRoom(22, 3, 1, 3, 1, 0, 1, 0);
    addRoom(8, 3, 1, 6, 1, 0, 1, 0);
    addRoom(11, 14, 1, 1, 1, 0, 1, 0);
    addRoom(18, 14, 1, 1, 1, 0, 1, 0);
    addRoom(10, 18, 1, 1, 1, 0, 1, 0);
    addRoom(10, 27, 1, 9, 1, 0, 1, 0);
    addRoom(20, 19, 1, 8, 1, 1, 1, 0);

    addRoom(17, 19, 3, 1, 0, 1, 0, 1);
    addRoom(17, 26, 1, 1, 0, 1, 0, 1);
    addRoom(27, 14, 5, 1, 0, 1, 0, 1);

    addDetail(8, 4, "bric");
    addDetail(13, 4, "blic");
    addDetail(4, 7, "bric");
    addDetail(18, 7, "blic");
    addDetail(20, 7, "bric");
    addDetail(22, 4, "bric");
    addDetail(24, 4, "blic");
    addDetail(4, 9, "tric");
    addDetail(8, 15, "blic");
    addDetail(10, 15, "bric");
    addDetail(18, 15, "blic");
    addDetail(20, 18, "tric");
    addDetail(20, 20, "bric");
    addDetail(26, 18, "tlic");
    addDetail(26, 14, "blic");
    addDetail(28, 14, "bric");
    addDetail(10, 19, "bric");
    addDetail(10, 26, "tric");
    addDetail(11, 15, 'dwh');
    addDetail(12, 15, 'dwh');
    addDetail(13, 15, 'dwh');
    addDetail(14, 15, 'dwh');
    addDetail(15, 15, 'dwh');
    addDetail(16, 15, 'dwh');
    addDetail(17, 15, 'dwh');
    addDetail(13, 26, 'dwh');
    addDetail(14, 26, 'dwh');
    addDetail(15, 26, 'dwh');
    addDetail(18, 25, 'dwv');
    addDetail(18, 24, 'dwv');
    addDetail(18, 23, 'dwv');
    addDetail(18, 22, 'dwv');
    addDetail(18, 21, 'dwv');
    addDetail(18, 20, 'dwv');
    addDetail(18, 19, 'dwv');
    addDetail(18, 18, 'dwv');
    addDetail(18, 17, 'dwv');
    addDetail(18, 16, 'dwv');
    addDetail(18, 12, 'dwv');
    addDetail(18, 11, 'dwv');
    addDetail(18, 10, 'dwv');
    addDetail(10, 16, 'dwv');
    addDetail(11, 12, 'dwv');
    addDetail(11, 11, 'dwv');
    addDetail(11, 10, 'dwv');
    addDetail(11, 13, 'dwet');
    addDetail(18, 13, 'dwet');
    addDetail(18, 26, 'dwet');
    addDetail(10, 17, 'dwet');
    addDetail(16, 26, 'dwel');
    addDetail(12, 26, 'twb');
    addDetail(18, 9, 'twr');
    addDetail(11, 9, 'twot');
    addDetail(16, 19, 'blic');
    addDetail(16, 21, 'tlic');
    addDetail(12, 16, 'gl');
    addDetail(13, 16, 'gm');
    addDetail(14, 16, 'gm');
    addDetail(15, 16, 'gm');
    addDetail(16, 16, 'gr');
    addDetail(12, 18, 'gl');
    addDetail(13, 18, 'gm');
    addDetail(14, 18, 'gm');
    addDetail(15, 18, 'gm');
    addDetail(16, 18, 'gr');
    addDetail(7, 4, 'mbr');
    addDetail(7, 5, 'mbr');
    addDetail(7, 6, 'mbr');
    addDetail(3, 4, 'mbl');
    addDetail(3, 5, 'mbl');
    addDetail(3, 3, 'mbl');
    addDetail(14, 4, 't');
    addDetail(14, 6, 't');
    addDetail(16, 3, 't');
    addDetail(16, 5, 't');
    addDetail(18, 4, 't');
    addDetail(18, 6, 't');
    addDetail(20, 3, 't');
    addDetail(20, 5, 't');

    addDetail(14, 10, 'ep');
    addDetail(27, 11, 'com');

    addDetail(4, 14, 'c');
    addDetail(5, 12, 'c');
    addDetail(6, 12, 'c');
    addDetail(7, 12, 'c');
    addDetail(6, 11, 'c');
    addDetail(8, 11, 'c');
    addDetail(8, 10, 'c');
    addDetail(9, 11, 'c');
    addDetail(9, 10, 'c');

}


        function openFullscreen() {
            if (document.getElementById('game').requestFullscreen) {
                document.getElementById('game').requestFullscreen();
            } else if (document.getElementById('game').mozRequestFullScreen) { /* Firefox */
                document.getElementById('game').mozRequestFullScreen();
            } else if (document.getElementById('game').webkitRequestFullscreen) { /* Chrome, Safari and Opera */
                document.getElementById('game').webkitRequestFullscreen();
            } else if (document.getElementById('game').msRequestFullscreen) { /* IE/Edge */
                document.getElementById('game').msRequestFullscreen();
            }
        }
        function addDetail(xx, yy, src) {
            blocks[(yy * width) + xx] = src;
        }
        function addRoom(xx,yy,ww,hh,wt,wr,wb,wl) {
            for (var l = 0; l < ww; l++) {
                for (var m = 0; m < hh; m++) {
                    blocks[(width * (yy + l)) + xx + m] = 'floor';
                }
            }
            if (wl) {
                for (var k = 0; k < ww; k++) {
                    blocks[(width * (yy + k)) + xx - 1] = 'lwall';
                }
            }
            if (wr) {
                for (var k = 0; k < ww; k++) {
                    blocks[(width * (yy + k)) + xx + hh] = 'rwall';
                }
            }
            if (wt) {
                for (var k = 0; k < hh; k++) {
                    blocks[(width * (yy - 1)) + xx + k] = 'twall';
                }
            }
            if (wb) {
                for (var k = 0; k < hh; k++) {
                    blocks[(width * (yy + ww)) + xx + k] = 'bwall';
                }
            }
            if (wt && wl) {
                blocks[(width * (yy - 1)) + xx - 1] = 'tlc';
            }
            if (wb && wl) {
                blocks[(width * (yy + ww)) + xx - 1] = 'blc';
            }
            if (wt && wr) {
                blocks[(width * (yy - 1)) + xx +  hh] = 'trc';
            }
            if (wb && wr) {
                blocks[(width * (yy + ww)) + xx + hh] = 'brc';
            }
        }
function startGame() {
    myGameArea.start();
    loadTiles();
    renderBlocks();

}

var myGameArea = {
    start : function() {
        document.getElementById("canvas").width = 700;
        document.getElementById("canvas").height = 700;
        this.context = document.getElementById("canvas").getContext("2d");
        this.interval = setInterval(updateGameArea, 50);
        window.addEventListener('keydown', function (e) {
            myGameArea.keys = (myGameArea.keys || []);
            myGameArea.keys[e.keyCode] = (e.type == "keydown");
        })
        window.addEventListener('keyup', function (e) {
            myGameArea.keys[e.keyCode] = (e.type == "keydown");
        })
        window.addEventListener('mousedown', function (e) {
      myGameArea.x = e.pageX;
      myGameArea.y = e.pageY;

    })
    window.addEventListener('mouseup', function (e) {
      myGameArea.x = false;
      myGameArea.y = false;
    })
    },
    clear : function(){
        this.context.clearRect(0, 0, document.getElementById("canvas").width, document.getElementById("canvas").height);
    }
}
function renderBlocks(){
    var ctx = myGameArea.context;
	for(var l = 0; l < blocks.length; l++){

		var rowDraw = Math.floor(l / width);
        var tileDraw = l % width;
        if ((tileDraw - xpos + 3) * 100 <= 775 && (tileDraw - xpos + 3) * 100 >= -75 && (rowDraw - ypos + 3) * 100 <= 775 && (rowDraw - ypos + 3) * 100 >= -75) {
            var imgs = new Image();
            switch (blocks[l]) {
                case 'out':
                    imgs.src = 'Space Texture (Outside Filler).PNG';
                    break;
                case 'floor':
                    imgs.src = 'Floor Texture.PNG';
                    break;
                case 'bwall':
                    imgs.src = 'Wall Texture (Bottom).PNG';
                    break;
                case 'rwall':
                    imgs.src = 'Wall Texture (Right).PNG';
                    break;
                case 'lwall':
                    imgs.src = 'Wall Texture (Left).PNG';
                    break;
                case 'twall':
                    imgs.src = 'Wall Texture (Top).PNG';
                    break;
                case 'tlc':
                    imgs.src = 'Corner Wall Texture (Top Left).PNG';
                    break;
                case 'trc':
                    imgs.src = 'Corner Wall Texture (Top Right).PNG';
                    break;
                case 'blc':
                    imgs.src = 'Corner Wall Texture (Bottom Left).PNG';
                    break;
                case 'brc':
                    imgs.src = 'Corner Wall Texture (Bottom Right).PNG';
                    break;
                case 'bric':
                    imgs.src = 'Inside Corner Wall (Bottom Right).PNG';
                    break;
                case 'blic':
                    imgs.src = 'Inside Corner Wall (Bottom Left).PNG';
                    break;
                case 'tric':
                    imgs.src = 'Inside Corner Wall (Top Right).PNG';
                    break;
                case 'tlic':
                    imgs.src = 'Inside Corner Wall (Top Left).PNG';
                    break;
                case 'dwh':
                    imgs.src = 'Double Sided Wall (Horisontal).PNG';
                    break;
                case 'dwv':
                    imgs.src = 'Double Sided Wall (Vertical).PNG';
                    break;
                case 'dwet':
                    imgs.src = 'Double Wall End (Top).PNG';
                    break;
                case 'dwel':
                    imgs.src = 'Double Wall End (Left).PNG';
                    break;
                case 'twb':
                    imgs.src = 'Triple Wall Bottom.png';
                    break;
                case 'twr':
                    imgs.src = 'Triple Wall Right.png';
                    break;
                case 'twot':
                    imgs.src = 'Triple Wall Outside Top.png';
                    break;
                case 'mbl':
                    imgs.src = 'Medbay Bed Texture (Left).PNG';
                    break;
                case 'mbr':
                    imgs.src = 'Medbay Bed Texture (Right).PNG';
                    break;
                case 'gl':
                    imgs.src = 'Right Greenhouse Texture.PNG';
                    break;
                case 'gm':
                    imgs.src = 'Center Greenhouse Texture.PNG';
                    break;
                case 'gr':
                    imgs.src = 'Left Greenhouse Texture.PNG';
                    break;
                case 't':
                    imgs.src = 'Cafeteria Table Texture.PNG';
                    break;
                case 'dwhw':
                    imgs.src = 'Double Sided Wall Wiring (Horizontal).png';
                    break;
                case 'wtw':
                    imgs.src = 'Wall Texture Wiring (Top).png';
                    break;
                case 'c':
                    imgs.src = 'Storage Crate Texture.PNG';
                    break;
                case 'tb':
                    imgs.src = 'Task Button.png';
                    break;
                case 'ep':
                    imgs.src = 'Electrical Panel Floor Texture.PNG';
                    break;
                case 'com':
                    imgs.src = 'Comms Task Texture.PNG';
                    break;
            }
            ctx.drawImage(imgs, (tileDraw - xpos + 3) * 100, (rowDraw - ypos + 3) * 100, 100, 100);
        }
	}
}

function left() {
    if (walkable.includes(blocks[(Math.floor(ypos) * width) + Math.ceil(xpos + 0.25)]) && walkable.includes(blocks[(Math.ceil(ypos) * width) + Math.ceil(xpos + 0.25)])) {

        xpos += 0.25;
        if (xpos >= width - 1) {
            xpos = width - 1;
        }
    }
}
        function right() {
            if (walkable.includes(blocks[(Math.floor(ypos) * width) + Math.floor(xpos - 0.25)]) && walkable.includes(blocks[(Math.ceil(ypos) * width) + Math.floor(xpos - 0.25)])) {

                xpos -= 0.25;
                if (xpos <= 0) {
                    xpos = 0;
                }
            }
}
function up(){
    if (walkable.includes(blocks[(Math.floor(ypos - 0.25) * width) + Math.floor(xpos)]) && walkable.includes(blocks[(Math.floor(ypos - 0.25) * width) + Math.ceil(xpos)])) {

        ypos -= 0.25;
        if (ypos <= 0) {
            ypos = 0;
        }
    }
}
        function down() {
            if (walkable.includes(blocks[(Math.ceil(ypos + 0.25) * width) + Math.floor(xpos)]) && walkable.includes(blocks[(Math.ceil(ypos + 0.25) * width) + Math.ceil(xpos)])) {

                ypos += 0.25;
                if (ypos >= height) {
                    ypos = height;
                }
            }
        }

        function updateGameArea() {
    myGameArea.clear();
    if (myGameArea.keys && (myGameArea.keys[37] || myGameArea.keys[97] || myGameArea.keys[65])) {
        right();
    }
    if (myGameArea.keys && (myGameArea.keys[39] || myGameArea.keys[100] || myGameArea.keys[68])) {
        left(); 
    }
    if (myGameArea.keys && (myGameArea.keys[38] || myGameArea.keys[119] || myGameArea.keys[87])) {
        up();
    }
    if (myGameArea.keys && (myGameArea.keys[40] || myGameArea.keys[115] || myGameArea.keys[83])) {
        down();
    }

    if (myGameArea.keys && (myGameArea.keys[37] || myGameArea.keys[97] || myGameArea.keys[65])) {
        if (document.getElementById('player').src != 'https://doomsdaygame.surge.sh/New%20Piskel%20(4).gif') {
            document.getElementById('player').src = 'New Piskel (4).gif';
        }
    } else if (myGameArea.keys && (myGameArea.keys[39] || myGameArea.keys[100] || myGameArea.keys[68])) {
        if (document.getElementById('player').src != 'https://doomsdaygame.surge.sh/New%20Piskel%20(5).gif') {
            document.getElementById('player').src = 'New Piskel (5).gif';

        }
    } else if (myGameArea.keys && (myGameArea.keys[38] || myGameArea.keys[119] || myGameArea.keys[87])) {
        if (document.getElementById('player').src != 'https://doomsdaygame.surge.sh/New%20Piskel%20(7).gif') {
            document.getElementById('player').src = 'New Piskel (7).gif';

        }
    } else if (myGameArea.keys && (myGameArea.keys[40] || myGameArea.keys[115] || myGameArea.keys[83])) {
        if (document.getElementById('player').src != 'https://doomsdaygame.surge.sh/New%20Piskel%20(6).gif') {
            document.getElementById('player').src = 'New Piskel (6).gif';

        }
    } else {
        document.getElementById('player').src = 'New Piskel (8).gif';
            }
            if (myGameArea.keys && (myGameArea.keys[99] || myGameArea.keys[67])) {
                console.log(xpos, ypos);
            }
            renderBlocks();
            if (myGameArea.keys && myGameArea.keys[32] && (tasks.includes(blocks[(Math.floor(ypos) * width) + Math.floor(xpos)])|| tasks.includes(blocks[(Math.ceil(ypos) * width) + Math.floor(xpos)])|| tasks.includes(blocks[(Math.floor(ypos) * width) + Math.ceil(xpos)])|| tasks.includes(blocks[(Math.ceil(ypos) * width) + Math.ceil(xpos)]))) {
                if (tasks.includes(blocks[(Math.floor(ypos) * width) + Math.floor(xpos)])){
                    blocks[(Math.floor(ypos) * width) + Math.floor(xpos)] = 'floor';
                }
                if (tasks.includes(blocks[(Math.ceil(ypos) * width) + Math.floor(xpos)])) {
                    blocks[(Math.ceil(ypos) * width) + Math.floor(xpos)] = 'floor';
                }
                if (tasks.includes(blocks[(Math.floor(ypos) * width) + Math.ceil(xpos)])) {
                    blocks[(Math.floor(ypos) * width) + Math.ceil(xpos)] = 'floor';
                }
                if (tasks.includes(blocks[(Math.ceil(ypos) * width) + Math.ceil(xpos)])) {
                    blocks[(Math.ceil(ypos) * width) + Math.ceil(xpos)] = 'floor';
                }
            }
    if (myGameArea.keys && (myGameArea.keys[109] || myGameArea.keys[77])) {
        var map = new Image();
        map.src = "map.png";
        myGameArea.context.drawImage(map, 0, 0, 700, 700)
        document.getElementById('player').style.opacity = 0;
        myGameArea.context.fillStyle = 'yellow';
        myGameArea.context.fillRect(xpos * 700 / 32, ypos * 700 / 32, 700 / 32, 700 / 32);
        myGameArea.context.fillStyle = 'red';

        for (var cnf = 0; cnf < blocks.length; cnf++) {
            for (var l = 0; l < tasks.length; l++) {
                if (blocks[cnf] == tasks[l]) {
                    myGameArea.context.fillRect(cnf % width * 700 / 32, Math.floor(cnf / width) * 700 / 32, 700 / 32, 700 / 32);

                }
            }
        }
    } else {
        document.getElementById('player').style.opacity = 'inherit';

    }
}</script>
    <div id="game"><canvas id="canvas"></canvas><img src="New Piskel (4).gif" id="player"/></div><button onclick="openFullscreen()">Fullscreen</button>
</body>
</html>
